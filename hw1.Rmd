---
header-includes:
- \usepackage{zxjatype}
- \setmainfont{Helvetica Neue}
- \setjamainfont{Hiragino Kaku Gothic Pro}
output:
  html_document: default
  pdf_document:
    latex_engine: xelatex
---
\fontsize{10}{11}
```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=4.2, fig.height=3.2, echo = TRUE)
##options(scipen=100)
```

# 統計学・データ分析勉強会／第１回宿題解答例

\hrulefill

　第$1$回宿題の解答例を以下に示します。いずれの問題も手計算で答えを求めることが可能ですが、解答例はRを使って作成しました。Rの基本操作の学習に役立てて下さい。一部、初学者には高度な部分がありますので、全てを理解できなくても構いません。

<br />

　最初に以下のコードをコンソールに入力して下さい。Rは通常、桁数の大きい数字を特別な数学表記で出力します（例えば`200000`は`2e+05`と表示します）が、今回は特別な命令によってその機能を停止します。

```{r opt}
options(scipen=100)　# 数字の表記方法を変えるための命令
```

\hrulefill

<br />

### 問１

　まず、平均月収と実質手取りのデータをそれぞれ`Gross_Income`と`Net_Income`という名前の変数（ベクトル）に格納します。

```{r q1-data}
Gross_Income <- c(314600, 403500, 348400, 360800, 277300, 353700, 190200, 478200, 
            465700, 339500, 80000, 39100, 302200, 80000, 74600, 44400, 163500,
            129700, 32000, 179500, 110200, 35500, 46200, 28400)
Net_Income <- c(240000, 280000, 270000, 270000, 190000, 240000, 140000, 270000,
            340000, 280000, 55000, 35000, 220000, 75000, 60000, 40000, 160000,
            110000, 30000, 140000, 95000, 30000, 40000, 25000)
```

　`length()`という関数を使い、作成したデータのサイズを確認しておきましょう。どちらも$24$個のデータが入っています。

```{r q1-length}
length(Gross_Income)
length(Net_Income)
```

　残念ながら、Rには度数分布表を作る関数が用意されていません。このため、ここでは自分で関数を定義することにします。以下のコードをコンソールに入力して下さい（各行の「`#`」以降は説明のためのコメントでありコードの実行内容には影響しないため、無視してOKです）。現段階では詳しい中身を理解する必要はありません。なお、下記コードは http://rplus.wb-nahce.info/rsemi_stat_basic/r_dosuubunnpuhyou_sakusei.html を修正のうえ転用しました。

```{r q1-table-function}
freqtab <- function( # 度数分布表を作成する関数を定義する
        x, # 度数分布表のもとになるデータ
        cn=1+log2(length(x)), # 階級の数は「スタージェスの公式」で決める
        wid=FALSE ) # 階級の幅
{
	x <- x[!is.na(x)] # 欠損値を除く
	min <- min(x) # データの最小値
	max <- max(x) # データの最大値
	ran <- max - min # データのレンジ（範囲）
	if(!wid){ wid <- round(abs(ran/cn), 3) } # 階級の幅を指定しない場合は自動で計算
	cla <- floor(x/wid)	# データを階級に振り分ける
	mnc <- min(cla) # 階級の最小値
	mxc <- max(cla) # 階級の最大値
	cla <- factor(cla, levels=mnc:mxc) # データを階級ごとに集計
	freq <- table(cla) # 階級ごとの度数を数える
	names(freq) <- paste(mnc:mxc*wid, "-", mnc:mxc*wid+wid) # 階級の名称を定義する
	percent <- round(freq/sum(freq)*100,2) # 相対度数（%）
	cum.pcnt <- round(cumsum(percent),2) # 累積相対度数（%）
	return(cbind(freq, percent, cum.pcnt)) # 度数分布表を返す
}
```

　これで、度数分布表を作るのに便利な`freqtab()`という関数ができました。

　それでは早速、平均月収の度数分布表を作成しましょう。階級の幅は$100000$円に指定します。

```{r q1-gross-table}
freqtab(Gross_Income, wid=100000) # 階級の幅を100000に指定
```

　上の度数分布表において、`freq`が度数、`percent`が相対度数（$\%$）、`cum.pcnt`が累積相対度数（$\%$）を表しています。

　実質手取りの度数分布表も同じように作成しましょう。

```{r q1-net-table}
freqtab(Net_Income, wid=100000) # 階級の幅を100000に指定
```

　一方、ヒストグラムは`hist()`という関数で簡単に作成できます。単純に`hist(Gross_Income)`とすれば、平均月収のヒストグラムができます。

```{r q1-gross-hist}
hist(Gross_Income)
```

　`hist`関数に渡す変数を変えることで、ヒストグラムの階級の数やラベルなどを指定できます。平均月収のヒストグラムを見やすくするため、タイトルとラベル、色を変更してみましょう。

```{r q1-gross-hist-mod}
# タイトル、横軸のラベル、縦軸のラベル、ヒストグラムの色、縦軸の範囲、文字サイズを指定する
hist(Gross_Income, main="Monthly gross income of 24 major cities", 
     xlab="Gross income (Yen)", ylab="Frequency", col="grey", ylim=c(0, 10), 
     cex.main=0.9, cex.axis=0.8, cex.lab=0.8) 
```

　同様に実質手取りのヒストグラムも作成しましょう。ここでは階級の数も指定しています。

```{r q1-net-hist-mod}
# 階級の数、タイトル、横軸のラベル、縦軸のラベル、ヒストグラムの色、縦軸の範囲、文字サイズを指定する
hist(Net_Income, breaks=4, main="Monthly net income of 24 major cities", 
     xlab="Net income (Yen)", ylab="Frequency", col="grey", ylim=c(0, 10),
     cex.main=0.9, cex.axis=0.8, cex.lab=0.8) 
```

\hrulefill

<br />

### 問2

　A国の月収調査のデータとB国の月収調査のデータを、それぞれ`IncA`、`IncB`という名前の変数に格納します。

```{r q2-data}
IncA <- c(530000, 520000, 510000, 500000, 490000, 480000, 470000)
IncB <- c(1200000, 900000, 800000, 500000, 60000, 30000, 10000)
```

　平均値は関数`mean()`、標準偏差は関数`sd()`を使って求めることができます。

　A国の月収の平均値と標準偏差を計算します。

```{r q2-mean-sd-A}
mean(IncA)
sd(IncA)
```

　B国の月収の平均値と標準偏差を計算します。

```{r q2-mean-sd-B}
mean(IncB)
sd(IncB)
```

　以上より、**A国とB国の月収の平均値は同じですが、B国の方が圧倒的にばらつき（標準偏差）が大きい**ことがわかります。

　ちなみに、この結果は`boxplot()`という関数を使って「箱ひげ図」で表示すると見た目にも分かりやすくなります。以下のように、A国はB国に比べて狭い月収の範囲にデータが集中していることが明らかです。

```{r q2-boxplot, fig.height=3.7}
boxplot(IncA, IncB, 
        names=c("Country A", "Country B"), main="Monthly income",　# ラベルやタイトルを指定
        cex.main=0.9, cex.axis=0.8, cex.lab=0.8) # 文字のサイズを指定
```

　なお、`summary()`という関数を使うとデータの平均値、中央値、最小値、最大値、四分位点をまとめて表示できます。

```{r q2-summary}
summary(IncA)
summary(IncB)
```

\hrulefill

<br />

### 問3

　正規分布（Normal Distribution）は`dnorm()`という関数に平均値`mean`と標準偏差`sd`を渡すことで作成できます。また、ある関数をグラフで表示したいときは、`curve()`という関数を使います。これらを組み合わせることで正規分布のグラフを描くことができます。

　平均値$53$、分散$400$の正規分布のグラフは以下のようになります。標準偏差は$\sqrt{400} = 20$であることに注意しましょう。

```{r q3-norm-1}
curve(dnorm(x, mean=53, sd=20), 
      from=0, to=110, # 横軸は0〜110に指定
      cex.axis=0.8, cex.lab=0.8)　# 文字のサイズを指定
```

　次に平均値$30$、分散$9$（標準偏差は$\sqrt{9} = 3$）の正規分布のグラフを描きます。なお、ここでは上で描いた正規分布との違いが分かりやすいように、$2$つのグラフを重ねて表示することにします。グラフの縦軸が先ほどと変わっている点に注意して下さい。

```{r q3-norm-2, fig.height=3.7}
curve(dnorm(x, mean=30, sd=3), 
      from=0, to=110, col="red", ylab="",
      cex.main=0.9, cex.axis=0.8, cex.lab=0.8) #　平均値30、分散9の正規分布を描く（色は赤）
curve(dnorm(x, mean=53, sd=20), add=TRUE) #　平均値53、分散400の正規分布を重ねて表示（色は黒）
label <- c("mean=30, sd=3", "mean=53, sd=20")　# 凡例に表示するラベルを定義
color <- c("red", "black") # 2つのグラフの色分け
legend("topright", legend=label, col=color, lty=c(1, 1), cex=0.8)　# 凡例を作成
```

　上のグラフから、**正規分布は分散が小さいほどグラフの幅が狭まり、背が高くなる**ことが分かります。なお、正規分布は確率密度を表しているため、どちらのグラフも面積（曲線と$x$軸で囲まれた範囲の面積）を合計すると$1$になります。

\hrulefill

<br />

### 問4

　北緯と平均気温をそれぞれ`hokui`、`kion`という名前の変数として定義します。

```{r q4-data}
Hokui <- c(0, 35, 30, 70, 10, 45, 60, 80, 15,　25)
Kion <- c(35, 18, 22, 4, 33, 12, 10, -10, 29, 23)
```

　**散布図**は`plot()`関数を使って描くことができます。

```{r q4-scatter}
plot(Hokui, Kion, cex.axis=0.8, cex.lab=0.8)
```

　上の散布図から、**「北緯が高いほど平均気温が低下する」という明確な傾向**が分かります。

　**相関係数**（Correlation Coefficient）は`cor()`という関数で計算します。

```{r q4-cor}
cor(Hokui, Kion)
```

　なお、相関係数について少しだけ丁寧に触れておきましょう。「北緯」と「平均気温」のような$n$個のデータの組が$(x_1, y_1)$, $(x_2, y_2)$, $\cdots$, $(x_n, y_n)$と与えられた場合、変数$x$と$y$の間の相関係数$r_{xy}$は以下の式で計算します。
$$
r_{xy} = \frac{\Sigma (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\Sigma(x_i - \bar{x})^2}\sqrt{\Sigma(y_i - \bar{y})^2}}
$$
　ここで、$\bar{x}$と$\bar{y}$はそれぞれ$x$と$y$の平均値を表します。$r_{xy}$の分子に注目すると、$r_{xy}$は「$x$が増大すれば$y$が増大する」傾向にあるデータではプラスになり、逆に「$x$が増大すれば$y$が減少する」傾向にあるデータではマイナスになることが予想できます。相関係数は常に$-1 \le r_{xy} \le 1$の値をとることが知られており（証明はやや難しいので、興味のある人は統計の教科書やウェブサイトを参照してください）、$r_{xy}=1$に近いほど「正の相関が強い」、$r_{xy}=-1$に近いほど「負の相関が強い」と表現します。

　上で計算したように北緯と平均気温の相関係数は$-0.98$ですから、$2$つの変数は**非常に強い負の相関をもつ**と言えます。

\hrulefill

<br />

### 問5

\( $1$ \)  **誤り（正しいとは限らない）**  
\( $2$ \)  **正しい**  
\( $3$ \)  **誤り（正しいとは限らない）**  

<br />

　**【 理由 】**

　この問題には複数の答え方があるので、論理的であれば正解とします。

　生徒$100$人の身長が、以下のヒストグラムのような分布になっていると仮定します。この分布では$100$人の身長の平均値は$163.5$cm、中央値は$160.6$cmです。平均値（$163.5$cm）が中央値より大きいため、身長が$163.5$cmよりも高い生徒の数は、低い生徒の数よりも少なくなります。よって仮説\( $1$ \)は誤りです。また、ヒストグラムを見ると、「身長が$160$cm以上で$170$cm未満の生徒」の数は、「$150$cm以上で$160$cm未満の生徒」や「$170$cm以上で$180$cm未満の生徒」の数よりも少ないことが明らかです。従って仮説\( $3$ \)も誤りです。一方、仮説\( $2$ \)は平均値の定義そのものですから（四捨五入の影響を無視すれば）正しいと言えます。


```{r q5-1, fig.height=3.7, fig.width=4.8, echo=FALSE}
set.seed(1)
height70 <- rnorm(70, mean=156, sd=7)
res <- 16350 - sum(height70)
height30 <- rep(c(res/30-3.5, res/30-.5, res/30+0.5, res/30+1.5, res/30+2), times=6)
height <- append(height70, height30)
hist(height, breaks=seq(140, 190, 10), col="grey", xlab="Height (cm)", main="Height of 100 students", cex.main=0.9, cex.axis=0.8, cex.lab=0.8)
abline(v=mean(height), col="red")
abline(v=median(height), col="blue")
label <- c("mean = 163.5 cm", "median = 160.6 cm")　# 凡例に表示するラベル
color <- c("red", "blue") # 2つのグラフの色分け
legend("topright", legend=label, col=color, lty=c(1, 1), cex=0.8)　# 凡例を作成
#mean(height)
#median(height)
```







